---
  name: CI

  on:
    push:
      branches:
        - main
    pull_request:
      branches:
        - main

  jobs:
    test:
      runs-on: ubuntu-latest

      strategy:
        matrix:
          python-version: ["3.13"]

      steps:
        - uses: actions/checkout@v4

        - name: Set up Python ${{ matrix.python-version }}
          uses: actions/setup-python@v5
          with:
            python-version: ${{ matrix.python-version }}
            cache: pip
            cache-dependency-path: pyproject.toml

        - name: Cache dependencies
          uses: actions/cache@v4
          with:
            path: ~/.cache/pip
            key: ${{ runner.os }}-pip-${{ matrix.python-version }}-${{ hashFiles('pyproject.toml') }}
            restore-keys: |
              ${{ runner.os }}-pip-${{ matrix.python-version }}-

        - name: Install dependencies
          run: |
            python -m pip install --upgrade pip wheel
            pip install -e .[dev,test] pytest pytest-cov coverage

        - name: Test with pytest
          run: |
            pytest -x --ff --tb=short --cov=. --cov-report=xml
